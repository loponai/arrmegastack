<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MegaStack</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
</head>
<body>

  <!-- Login -->
  <div id="login-screen" class="screen">
    <div class="login-wrap">
      <div class="login-card">
        <div class="login-hero">⚡</div>
        <h1 id="login-title">Welcome to MegaStack</h1>
        <p class="login-sub" id="login-sub">Your private server is ready for you.</p>
        <form id="login-form">
          <input type="password" id="login-password" placeholder="Enter your password" autocomplete="current-password" required>
          <button type="submit" class="btn-main" id="login-btn">Let me in</button>
          <p id="login-error" class="error-msg hidden"></p>
        </form>
      </div>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="screen hidden">

    <!-- Top Bar -->
    <header class="topbar" role="banner">
      <div class="topbar-left">
        <span class="brand" aria-label="MegaStack Dashboard">⚡ MegaStack</span>
      </div>
      <nav class="topbar-nav" role="navigation" aria-label="Main navigation">
        <a href="#" data-page="home" class="tab active" aria-current="page">Home</a>
        <a href="#" data-page="apps" class="tab">Apps</a>
        <a href="#" data-page="logs" class="tab">Logs</a>
        <a href="#" data-page="settings" class="tab">Settings</a>
        <a href="#" data-page="help" class="tab">Help</a>
      </nav>
      <div class="topbar-right">
        <span class="host-pill" id="host-pill" aria-label="Server info"></span>
        <button id="logout-btn" class="btn-ghost" aria-label="Log out">Log out</button>
      </div>
    </header>

    <!-- Pages -->
    <main class="main" role="main">

      <!-- HOME -->
      <section id="page-home" class="page active">
        <div id="onboarding-banner" class="onboarding-banner hidden"></div>
        <div class="hero-banner">
          <div class="hero-text">
            <h1 id="greeting">Hey there! &#128075;</h1>
            <p id="hero-sub">Everything's looking good.</p>
          </div>
          <div class="hero-stats">
            <div class="hero-stat" title="Number of services currently running">
              <span class="hero-stat-num" id="stat-running">0</span>
              <span class="hero-stat-label">Running</span>
            </div>
            <div class="hero-stat-divider"></div>
            <div class="hero-stat" title="Total number of services in your stack">
              <span class="hero-stat-num" id="stat-total">0</span>
              <span class="hero-stat-label">Total</span>
            </div>
            <div class="hero-stat-divider"></div>
            <div class="hero-stat" title="Feature groups you have turned on (see Apps page)">
              <span class="hero-stat-num" id="stat-modules">0</span>
              <span class="hero-stat-label">Modules</span>
            </div>
          </div>
        </div>

        <!-- System Gauges -->
        <div class="system-gauges" id="system-gauges">
          <div class="gauge-card">
            <div class="gauge-ring" id="gauge-cpu"><svg viewBox="0 0 36 36"><path class="gauge-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><path class="gauge-fill" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><text x="18" y="20.5" class="gauge-text">--%</text></svg></div>
            <div class="gauge-label">CPU</div>
          </div>
          <div class="gauge-card">
            <div class="gauge-ring" id="gauge-ram"><svg viewBox="0 0 36 36"><path class="gauge-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><path class="gauge-fill" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><text x="18" y="20.5" class="gauge-text">--%</text></svg></div>
            <div class="gauge-label">RAM</div>
            <div class="gauge-detail" id="gauge-ram-detail"></div>
          </div>
          <div class="gauge-card">
            <div class="gauge-ring" id="gauge-disk"><svg viewBox="0 0 36 36"><path class="gauge-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><path class="gauge-fill" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" /><text x="18" y="20.5" class="gauge-text">--%</text></svg></div>
            <div class="gauge-label">Disk</div>
            <div class="gauge-detail" id="gauge-disk-detail"></div>
          </div>
          <div class="gauge-card">
            <div class="gauge-uptime" id="gauge-uptime">--</div>
            <div class="gauge-label">Uptime</div>
          </div>
        </div>

        <!-- Quick Access -->
        <h2 class="section-title">Your Services <span class="section-hint">Click any card to open it</span></h2>
        <div class="services-grid" id="services-grid"></div>

        <!-- Activity -->
        <h2 class="section-title" style="margin-top:2.5rem">What's Running</h2>
        <div class="running-list" id="running-list"></div>
      </section>

      <!-- APPS (App Store) -->
      <section id="page-apps" class="page hidden">
        <div class="page-intro">
          <h1>App Store</h1>
          <p>Turn features on or off like flipping a switch. Each module is a group of related services that work together.</p>
          <div class="store-stats" id="store-stats"></div>
        </div>
        <div class="store-filter-bar" id="store-filters"></div>
        <div class="apps-grid" id="apps-grid"></div>
      </section>

      <!-- LOGS -->
      <section id="page-logs" class="page hidden">
        <div class="page-intro">
          <h1>Live Logs</h1>
          <p>A real-time diary of what each service is doing. Mostly useful when something breaks &mdash; look for lines containing "error" in red.</p>
        </div>
        <div class="logs-controls">
          <select id="log-select" class="pill-select">
            <option value="">Pick a service...</option>
          </select>
        </div>
        <div class="log-window">
          <pre id="log-output">Pick a service above to see its logs here.</pre>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="page-settings" class="page hidden">
        <div class="page-intro">
          <h1>Settings</h1>
          <p>Your server configuration. The "General" section is safe to change. The "VPN & Media" section controls your VPN tunnel and media paths.</p>
        </div>

        <div class="settings-cards" id="settings-cards"></div>

        <div class="settings-actions">
          <button class="btn-main" id="btn-save-config">Save Changes</button>
        </div>

        <h2 class="section-title" style="margin-top:3rem">Backups</h2>
        <p class="section-desc">Download a snapshot of your configs and settings. Media files aren't included (they're huge). We recommend creating a backup before changing settings.</p>
        <div class="backup-actions">
          <button class="btn-soft" id="btn-create-backup">Create Backup Now</button>
        </div>
        <div class="backup-list" id="backup-list"></div>
      </section>

      <!-- HELP -->
      <section id="page-help" class="page hidden">
        <div class="page-intro">
          <h1>Help & Learn</h1>
          <p>New to self-hosting? No worries! Here's everything you need to know.</p>
        </div>

        <div class="help-section">
          <h2>What is MegaStack?</h2>
          <p>MegaStack is your personal media server. It runs a collection of apps that automatically find, download, and stream movies, TV shows, and music &mdash; all through a VPN-protected tunnel.</p>
        </div>

        <div class="help-section">
          <h2>What is Docker?</h2>
          <p>Docker is the technology that runs all your services. Think of it like separate apartments in a building &mdash; each service lives in its own space and can't mess with the others. If one app crashes, the rest keep running normally.</p>
        </div>

        <div class="help-section">
          <h2>What are Modules?</h2>
          <p>Modules are groups of related services. For example, the "Media Center" module includes everything you need for movies, TV, and music: a VPN tunnel, download clients, search tools, and a streaming server. You can turn entire modules on or off from the <strong>Apps</strong> page.</p>
        </div>

        <div class="help-section">
          <h2>Your Services Explained</h2>
          <div class="help-services" id="help-services"></div>
        </div>

        <div class="help-section">
          <h2>Common Questions</h2>

          <div class="help-faq">
            <h3>How do I access my services from outside?</h3>
            <p>Set up a domain name pointing to your server and use <strong>Nginx Proxy Manager</strong> to create subdomains like <em>jellyfin.yourdomain.com</em>. NPM handles SSL certificates automatically so your connections are secure.</p>
          </div>

          <div class="help-faq">
            <h3>What should I do if something breaks?</h3>
            <p>Go to the <strong>Logs</strong> page and check the logs for the broken service. Look for lines containing "error" or "failed". Try restarting the service from the Home page. If that doesn't help, check the service's official documentation (linked below each service description).</p>
          </div>

          <div class="help-faq">
            <h3>How do I update my services?</h3>
            <p>Use the command <code>megastack update</code> via SSH, or check if there's an update button in your dashboard. Updates pull the latest versions of all your apps.</p>
          </div>

          <div class="help-faq">
            <h3>I forgot my dashboard password!</h3>
            <p>Connect to your server via SSH and edit the <code>.env</code> file. Remove the value next to <code>MS_ADMIN_PASSWORD_HASH=</code> (leave it blank). Then restart: <code>megastack restart dashboard</code>. You'll be asked to set a new password on next login.</p>
          </div>

          <div class="help-faq">
            <h3>How do I set up my VPN for downloads?</h3>
            <p>Go to <strong>Settings</strong> and fill in the "VPN & Media" section with your VPN provider credentials. MegaStack routes all download traffic through a VPN tunnel (Gluetun) so your activity stays private. If the VPN goes down, downloads automatically stop.</p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Confirm dialog -->
  <div class="modal-overlay hidden" id="confirm-overlay" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
    <div class="modal-card">
      <h3 id="confirm-title">Are you sure?</h3>
      <p id="confirm-message"></p>
      <div class="modal-actions">
        <button class="btn-soft" id="confirm-cancel">Cancel</button>
        <button class="btn-main danger" id="confirm-ok">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div class="toast-wrap" id="toast-wrap" aria-live="polite" role="status"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
